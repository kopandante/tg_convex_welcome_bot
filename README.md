# Telegram Convex Welcome Bot

Telegram-бот для приветствия новых участников в группе с топиками (форумом). Работает на [Convex](https://convex.dev).

## Как это работает

1. Бот добавляется в группу -- автоматически запоминает `chatId` и свой username.
2. Администратор упоминает бота в нужном топике -- бот запоминает этот топик как тему для знакомств.
3. Когда в группу вступает новый участник, бот отправляет приветственное сообщение в тему для знакомств. Каждый участник приветствуется только один раз.

## Стек

- [Convex](https://convex.dev) -- бэкенд (база данных, серверные функции, HTTP-эндпоинт)
- [Bun](https://bun.sh) -- рантайм и пакетный менеджер
- [Biome](https://biomejs.dev) -- линтинг и форматирование

## Настройка

### 1. Установка зависимостей

```bash
bun install
```

### 2. Convex

```bash
bunx convex dev
```

При первом запуске Convex попросит авторизоваться и создаст проект.

### 3. Переменные окружения

В Convex dashboard задать:

- `TELEGRAM_BOT_TOKEN` -- токен бота от [@BotFather](https://t.me/BotFather)
- `TELEGRAM_WEBHOOK_SECRET` -- произвольная строка для верификации вебхука
- `CONVEX_SITE_URL` -- URL HTTP-эндпоинта Convex (выдается при деплое)

### 4. Вебхук

```bash
bun run setup-webhook
```

Скрипт регистрирует вебхук в Telegram API и выводит текущую конфигурацию.

### 5. Настройка бота в группе

1. Добавить бота в группу с топиками.
2. Упомянуть бота (`@username`) в топике, который будет использоваться для знакомств.
3. Бот подтвердит настройку сообщением в этом топике.

## Скрипты

| Команда | Описание |
| --- | --- |
| `bun run dev` | Запуск Convex в режиме разработки |
| `bun run setup-webhook` | Регистрация вебхука в Telegram |
| `bun run check` | Проверка кода (Biome) |
| `bun run fix` | Автоисправление (Biome) |

## Структура

```
convex/
  http.ts        -- вебхук-эндпоинт, роутинг Telegram-обновлений
  telegram.ts    -- логика приветствий и настройки топика
  config.ts      -- хранение конфигурации бота (chatId, introTopicId)
  members.ts     -- учет приветствованных участников
  schema.ts      -- схема базы данных
scripts/
  setup-webhook.ts -- регистрация вебхука
```
